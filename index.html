<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Dynamic Route Configuration in angular2</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/main.css" media="screen">
    <link rel="stylesheet" type="text/css" href="node_modules/bootstrap/dist/css/bootstrap.css" media="screen">


  </head>
  <body>
    <section class="page-header" style="margin-top:0; height:100%;">
      <h1 class="project-name" style="margin-top:24%">Rolland Safort Ntague's Blog</h1>
      <h2 class="project-tagline">Dynamic Route Configuration in angular2</h2>
    </section>

    <div class="container-fluid">
      <div class="row">
        <div  class="col-sm-2">
          <img src="images/profile.jpg" width="120px" height="120px" style="display:block; margin:auto; border-radius:6px;"></img>
          <div class="text-center" style="margin-top:20px;">Rolland Safort N.</div>
          <div class="text-center">email:<span> rollandsafort@gmail.com<span></div>

        </div>

        <div class="col-sm-8">
          <div class="margin-bottom-20">
            A few weeks ago i was working on a project where we had to implement an admin portal for a customer.
            Since we didn't how many components and  what components are going to be loaded, we had come up with a solution that would work for
            any given situation. Therefore, the dynamic component loading and dynamic routes configuration were the best options.
            On this post i'm going to cover the dynamic route configuration only, asuming the components are already loaded.I will cover a more complete scenario in a different post,
            where both the components and the route definitions lazy-loaded.
          </div>

          Dynamic Routing and dynamic route configuration is a common need for all major web applications. Angular2 is still in beta at the time of this writing, but provides
          a way for us to implement dynamic route configuration, using the <a href="https://angular.io/docs/js/latest/api/router/AsyncRoute-class.html" target="_blank"> AsyncRoute</a>
          mechanism. AsyncRoute is used to route a path to an asynchronously loaded component.


          <h4> Example usage of the AsyncRoute</h4>
          <pre class="highlight">
            <code class="language-ts" data-lang="ts">
import {RouteConfig, AsyncRoute} from 'angular2/router';
@RouteConfig([
      new AsyncRoute({path: '/home', loader: () => Promise.resolve(MyLoadedCmp), name:
    'MyLoadedCmp'})
])
            </code>
          </pre>

          <div>
            As you can see from the code above,
            all we need is to provide is a routing path, the component we want to load on that path, and an optional component name.
          <div>

            <div>To make it more flexible and dynamic, routes definition can be saved on a remote database or configuration file, then loaded on-demand to configure the routes on the front end. </div>
  <div>

  <h4> Dynamic Route configuration Example</h4>

            <div>admin.ts</div>
            <pre class="highlight">
              <code class="language-ts" data-lang="ts">

<!-- import {Component,View, provide} from 'angular2/core'
import {ROUTER_DIRECTIVES, RouteConfig, RouterLink} from 'angular2/router';
import {Navigator} from './layout/navigator/navigator';
import {Home} from './components/home/home.component';
import {Order} from './components/order/order.component';
import {DynamicRouteConfigurator} from './services/router';

@Component({
selector:'admin',
providers: [
  RouterLink,
  DynamicRouteConfigurator
]
})

@RouteConfig([
])

@View({
   templateUrl:'admin.html',
   directives: [ROUTER_DIRECTIVES, Header, Navigator, CORE_DIRECTIVES]
}) -->

export class Admin{
  appRoutes: any[];
constructor(private dynamicRouteConfigurator: DynamicRouteConfigurator) {
  this.appRoutes = this.getAppRoutes();
    let routes = [ { path: '/', component: Home, name: 'Dashboard' },
                { path: '/order', component: Order, name: 'Order' }];
    var i = -1;
    while(++i < routes.length){
       this.dynamicRouteConfigurator.addRoute(this.constructor, routes[i]);
    }
    this.appRoutes = this.getAppRoutes();
}

private getAppRoutes(): any[] {
    return this.dynamicRouteConfigurator
    .getRoutes(this.constructor).configs.map(route => {
      return { link: [`/${route.name}`], title: route.name,icon:'mdi-action-dashboard' };
    });
}

}
              </code>
            </pre>
            </div>


            <div>
               router service
            </div>

            <div>
              <pre class="highlight">
                <code class="language-ts" data-lang="ts">
  /// <reference path="../../../node_modules/reflect-metadata/reflect-metadata.d.ts"/>

import {Injectable, Type,ViewEncapsulation} from 'angular2/core'
import {RouteRegistry} from 'angular2/router'
import {Admin} from '../admin'

@Injectable()
export class DynamicRouteConfigurator {
  constructor(private registry: RouteRegistry) {}

  addRoute(component: Type, route) {
    let routeConfig = this.getRoutes(component);
    routeConfig.configs.push(route);
    this._updateRouteConfig(component, routeConfig);
    this.registry.config(component, route);
  }
  getRoutes(component: Type) {
      return Reflect.getMetadata('annotations', component)
          .filter(a => {
            return a.configs!=undefined;
          }).pop();
  }
  _updateRouteConfig(component: Type, routeConfig) {
    let annotations = Reflect.getMetadata('annotations', component);
    let routeConfigIndex = -1;
    for (let i = 0; i < annotations.length; i += 1) {
        if (annotations[i].configs!=undefined) {
            routeConfigIndex = i;
            break;
          }
    }
    if (routeConfigIndex < 0) {
      throw new Error('No route metadata attached to the component');
    }
    annotations[routeConfigIndex] = routeConfig;
    Reflect.defineMetadata('annotations', annotations, Admin);
  }
}  </code>

              </pre>

            </div>




            <div>
               left navigation component
            </div>

            <div>
              <pre class="highlight">
                <code class="language-ts" data-lang="ts">
  import {Component, View,Input} from 'angular2/core';
  import {RouterLink,ROUTER_DIRECTIVES} from 'angular2/router';

  @Component({
      selector: 'navigator',
  })


  @View({
  	templateUrl: 'layout/navigator/navigator.html',
    directives: [RouterLink,ROUTER_DIRECTIVES]
  })
  export class Navigator {
  @Input() navigations: any[];
      constructor(link:RouterLink) {
      }
  }
</code>

              </pre>

            </div>


                        <div>
                          The naviation array is passed to the left left navigation component as follows
                        </div>

                        <div>
                          <pre class="highlight">
                            <code class="language-ts" data-lang="ts">
	                               &ltnavigator  [navigations]="appRoutes"&gt &lt/navigator&gt
                            </code>

                          </pre>

                        </div>

        </div>
        <div class="col-sm-2"></div>
        <div class="clearfix"></div>
    </div>
    <div> 15 February 2016</div>

      <footer class="site-footer text-center">
        angular2 tips
      </footer>

    </div>

<script src="node_modules/jquery/dist/jquery.min.js"></script>
<script src="node_modules/bootstrap/dist/js/bootstrap.js"></script>
  </body>
</html>
